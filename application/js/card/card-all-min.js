function refreshCards(){var e=Ext.getCmp("categoryPane");var t=e.getSelectionModel().getSelectedNode();var n=Ext.getCmp("cardGrid");if(t.id){n.store.load({params:{category_id:t.id}})}}function newCard(){var e=new Ext.FormPanel({id:"ncrf",labelWidth:100,frame:true,title:"New Card",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[textArea("Question","question"),textArea("Answer","answer"),comboBox("Category","category_id","php/category/getCategories.php")],buttons:[actionButton("Add","silk-application-add","php/card/newCard.php","Adding card","ncrf",refreshCards),cancelButton("ncrf")]});return e}function editCard(){var e=new Ext.FormPanel({id:"ecrf",labelWidth:100,frame:true,title:"Edit Card",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Card","card_id","php/card/getCards.php?category_id="+getSelectedCategory().id),textArea("Question","question"),textArea("Answer","answer"),comboBox("New Category","category_id","php/category/getCategories.php")],buttons:[actionButton("Update","silk-application-add","php/card/editCard.php","Updating card","ecrf",refreshCards),cancelButton("ecrf")]});return e}function deleteCard(){var e=new Ext.FormPanel({id:"dcrf",labelWidth:100,frame:true,title:"Delete Card",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Delete","card_id","php/card/getCards.php?category_id="+getSelectedCategory().id)],buttons:[actionButton("Delete","silk-folder-delete","php/card/deleteCard.php","Removing card","dcrf",refreshCards),cancelButton("dcrf")]});return e}function percentage(e){e=e*100+"";if(e!="100")e=e.substring(0,2);return e+"%"}function date(e){var t=Date.parseDate((new Date).format("Y-m-d H:i:s"),"Y-m-d H:i:s");var n=Date.parseDate("0000-00-00 00:00:00","Y-m-d H:i:s");var r=Ext.util.Format.dateRenderer("Y m d");if(e.between(n,t))return'<span style="color:green">'+r(e)+"</span>";return r(e)}var cardMenu=new Ext.menu.Menu({items:[menuItem("rcrm","Refresh Cards","silk-arrow-refresh",refreshCards,false),"-",menuItem("ncrm","Add Card","silk-application-add",newCard),menuItem("ecrm","Edit Card","silk-application-edit",editCard),menuItem("dcrm","Delete Card","silk-application-delete",deleteCard),"-",menuItem("bucrm","Bulk Upload","silk-application-go",bulkUpload)],listeners:{itemclick:function(e){switch(e.id){case"ncrm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&(t.parentNode||t.text=="All")){var n=Ext.getCmp("ncrf");var r=n.get(0);var i=n.get(1);var s=n.get(2);s.getStore().load({callback:function(){s.setValue(t.id)}});r.setValue("New Question");i.setValue("New Answer")}break;case"ecrm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();var o=Ext.getCmp("cardGrid").getSelectionModel().getSelected();if(o!=null){var u=Ext.getCmp("ecrf");var a=u.get(0);var f=u.get(1);var l=u.get(2);var c=u.get(3);a.getStore().load({callback:function(){a.setValue(o.get("id"))}});c.getStore().load({callback:function(){c.setValue(t.id)}});f.setValue(o.get("question"));l.setValue(o.get("answer"))}break;case"dcrm":var o=Ext.getCmp("cardGrid").getSelectionModel().getSelected();if(o!=null){var s=Ext.getCmp("dcrf").get(0);s.getStore().load({callback:function(){s.setValue(o.get("id"))}})}break;case"bucrm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&(t.parentNode||t.text=="All")){var h=Ext.getCmp("buf");var p=h.get(0);var s=h.get(1);s.getStore().load({callback:function(){s.setValue(t.id)}});p.setValue("Upload File")}break;break;case"crrv":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();var c=Ext.getCmp("rf").get(0);c.getStore().load({callback:function(){c.setValue(t.id)}});break}}}});var cardGridStore=new Ext.data.ArrayStore({autoSave:true,url:"php/card/cardGrid.php",fields:[{name:"id",type:"int"},{name:"category_id",type:"int"},{name:"question",type:"string"},{name:"answer",type:"string"},{name:"hint",type:"string"},{name:"last_test",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"next_test",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"total_test",type:"int"},{name:"tests_passed",type:"int"},{name:"pass_rate",type:"float"}]});var cardGrid=new Ext.grid.GridPanel({id:"cardGrid",store:cardGridStore,columns:[{id:"Question",header:"Question",sortable:true,dataIndex:"question"},{id:"Pass Rate",header:"Pass Rate",sortable:true,renderer:percentage,dataIndex:"pass_rate",width:75,fixed:true,align:"right"},{id:"Last Test",header:"Last Test",sortable:true,renderer:Ext.util.Format.dateRenderer("Y m d"),dataIndex:"last_test",width:75,fixed:true,align:"center"},{id:"Next Test",header:"Next Test",sortable:true,renderer:date,dataIndex:"next_test",width:75,fixed:true,align:"center"}],stripeRows:true,autoExpandColumn:"Question",width:495,height:450,contextMenu:cardMenu,listeners:{headercontextmenu:function(e,t,n){n.stopEvent();e.contextMenu.showAt(n.getXY())},rowcontextmenu:function(e,t,n){n.stopEvent();e.getSelectionModel().selectRow(t);e.contextMenu.showAt(n.getXY())}}});cardGrid.render("rightColumn")