function actionButton(e,t,n,r,i,s,o){var u;if(o){u={text:e,iconCls:t,handler:function(){var e=Ext.getCmp(i);e.getForm().submit({url:n,waitMsg:r,success:s,failure:reportError});e.hide();cardGrid.show()}}}else{u={text:e,iconCls:t,handler:function(){var e=Ext.getCmp(i);e.getForm().submit({url:n,waitMsg:r,success:s,failure:reportError});e.hide();cardGrid.show()}}}return u}function cancelButton(e){var t={text:"Cancel",iconCls:"silk-cancel",handler:function(){Ext.getCmp(e).hide();cardGrid.show()}};return t}function genericButton(e,t,n,r){var i;if(r){i={id:r,text:e,iconCls:t,handler:n}}else{i={text:e,iconCls:t,handler:n}}return i}function comboBox(e,t,n){if(!n)n="php/category/getCategories.php";var r=new Ext.form.ComboBox({fieldLabel:e,name:t,layout:"anchor",readOnly:true,triggerAction:"all",store:new Ext.data.ArrayStore({url:n,fields:[{name:"value",type:"int"},{name:"text",type:"string"}]}),hiddenName:t,valueField:"value",displayField:"text",emptyText:"Press down ... ",mode:"remote",listWidth:230});return r}function fileUpload(e,t,n,r,i){var s;if(!r)r=false;if(!i)i="";if(!n){s={fieldLabel:e,name:t,layout:"anchor",xtype:"textfield",disabled:r,value:i,inputType:"file"}}else{s={fieldLabel:e,name:t,layout:"anchor",xtype:"textfield",width:n,disabled:r,value:i,inputType:"file"}}return s}function formHandler(e,t){return function(){hide(["cardGrid","ncf","ecf","dcf","ncrf","ecrf","dcrf","rf","rpf","rpf2"],t);var n=e();n.render("rightColumn");n.show();return true}}function formHandler2(e,t){return function(){hide(["cardGrid","ncf","ecf","dcf","ncrf","ecrf","dcrf","rf","rpf","rpf2"],t);var n=e;n.render("rightColumn");n.show();return true}}function hide(e,t){for(i=0;i<e.length;i++){cmp=Ext.getCmp(e[i]);if(cmp!=null&&e[i]!=t)cmp.hide()}}function menuItem(e,t,n,r,i){if(i==null||i){return{id:e,text:t,iconCls:n,handler:formHandler(r,e)}}else{return{id:e,text:t,iconCls:n,handler:r}}}function reportError(e,t){Ext.Msg.alert("Error",t.result.errorMessage)}function textArea(e,t){var n={fieldLabel:e,name:t,layout:"anchor",xtype:"textarea"};return n}function textField(e,t,n,r,i){var s;if(!r)r=false;if(!i)i="";if(!n){s={fieldLabel:e,name:t,layout:"anchor",xtype:"textfield",disabled:r,value:i}}else{s={fieldLabel:e,name:t,layout:"anchor",xtype:"textfield",width:n,disabled:r,value:i}}return s}function toolbarButton(e,t,n,r){var i=new Ext.Toolbar.Button({id:e,text:t,arrowAlign:"right",iconAlign:"top",iconCls:n,height:60,width:80,scale:"large",menu:r});return i}function bulkUpload(){var e=new Ext.FormPanel({id:"buf",fileUpload:true,labelWidth:100,frame:true,title:"Bulk Upload",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[fileUpload("File","file"),comboBox("Parent Category","parent_id")],buttons:[actionButton("Upload","silk-folder-go","php/category/bulkUpload.php","Uploading","buf",refreshCategories),cancelButton("buf")]});return e}function refreshCategories(){var e=Ext.getCmp("categoryPane");var t=new Ext.LoadMask("categoryPane",{msg:"Loading categories...",removeMask:true});t.show();var n=e.getRootNode();e.getLoader().load(n,function(){t.hide()});n.expand()}function newCategory(){var e=new Ext.FormPanel({id:"ncf",labelWidth:100,frame:true,title:"New Category",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[textField("Name","name"),comboBox("Parent Category","parent_id")],buttons:[actionButton("Add","silk-folder-add","php/category/newCategory.php","Adding Category","ncf",refreshCategories),cancelButton("ncf")]});return e}function editCategory(){var e=new Ext.FormPanel({id:"ecf",labelWidth:100,frame:true,title:"Edit Category",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Category","category_id"),textField("New Name","name"),comboBox("New Parent Category","parent_id")],buttons:[actionButton("Update","silk-folder-edit","php/category/editCategory.php","Updating category","ecf",refreshCategories),cancelButton("ecf")]});return e}function deleteCategory(){var e=new Ext.FormPanel({id:"dcf",labelWidth:100,frame:true,title:"Delete Category",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Delete","category_id")],buttons:[actionButton("Delete","silk-folder-delete","php/category/deleteCategory.php","Removing category","dcf",refreshCategories),cancelButton("dcf")]});return e}function getSelectedCategory(){return categoryPane.getSelectionModel().getSelectedNode()}function refreshCards(){var e=Ext.getCmp("categoryPane");var t=e.getSelectionModel().getSelectedNode();var n=Ext.getCmp("cardGrid");if(t.id){n.store.load({params:{category_id:t.id}})}}function newCard(){var e=new Ext.FormPanel({id:"ncrf",labelWidth:100,frame:true,title:"New Card",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[textArea("Question","question"),textArea("Answer","answer"),comboBox("Category","category_id","php/category/getCategories.php")],buttons:[actionButton("Add","silk-application-add","php/card/newCard.php","Adding card","ncrf",refreshCards),cancelButton("ncrf")]});return e}function editCard(){var e=new Ext.FormPanel({id:"ecrf",labelWidth:100,frame:true,title:"Edit Card",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Card","card_id","php/card/getCards.php?category_id="+getSelectedCategory().id),textArea("Question","question"),textArea("Answer","answer"),comboBox("New Category","category_id","php/category/getCategories.php")],buttons:[actionButton("Update","silk-application-add","php/card/editCard.php","Updating card","ecrf",refreshCards),cancelButton("ecrf")]});return e}function deleteCard(){var e=new Ext.FormPanel({id:"dcrf",labelWidth:100,frame:true,title:"Delete Card",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Delete","card_id","php/card/getCards.php?category_id="+getSelectedCategory().id)],buttons:[actionButton("Delete","silk-folder-delete","php/card/deleteCard.php","Removing card","dcrf",refreshCards),cancelButton("dcrf")]});return e}function percentage(e){e=e*100+"";if(e!="100")e=e.substring(0,2);return e+"%"}function date(e){var t=Date.parseDate((new Date).format("Y-m-d H:i:s"),"Y-m-d H:i:s");var n=Date.parseDate("0000-00-00 00:00:00","Y-m-d H:i:s");var r=Ext.util.Format.dateRenderer("Y m d");if(e.between(n,t))return'<span style="color:green">'+r(e)+"</span>";return r(e)}function reviewCallBack(e,t){var n=t.result.card;if(n.length==0){Ext.getCmp("rbt").enable();Ext.getCmp("rpf2").hide();refreshCards();cardGrid.render("rightColumn");return}id=n[0];q=n[1];a=n[2];rpf=reviewPanel(id,q,a);formHandler2(rpf,rpf.getId())()}function review(e){var t=new function(){var t=new Ext.FormPanel({id:"rf",labelWidth:100,frame:true,title:"Review!",bodyStyle:"padding:5px 5px 0",width:495,height:450,defaults:{width:230},items:[comboBox("Review Category","category_id")],buttons:[actionButton("Review","silk-page-go","php/review/reviewStart.php","Fetching Cards","rf",reviewCallBack),{text:"Cancel",iconCls:"silk-cancel",handler:function(){e.enable();Ext.getCmp("rf").hide();cardGrid.show()}}]});return t};return t}function reviewPanel(e,t,n){t='<font size="4">'+t+"</font>";n='<font size="4">'+n+"</font>";var r=new Ext.FormPanel({id:"rpf",labelWidth:100,frame:true,title:"Review!",bodyStyle:"padding:5px 5px 0",width:495,height:450,items:[new Ext.Panel({autoScroll:true,html:t,height:180,width:450}),{xtype:"hidden",name:"a",value:"b"}],buttons:[genericButton("Show Answer","silk-page-go",function(){return showAnswer(e,t,n)},"sab"),actionButton("Later","silk-arrow-refresh","php/review/reviewContinuous.php?instruction=skip","Recycling Card","rpf",reviewCallBack,"recb")]});return r}function reviewPanel2(e,t,n){var r=new Ext.FormPanel({id:"rpf2",labelWidth:100,frame:true,title:"Review!",bodyStyle:"padding:5px 5px 0",width:495,height:450,items:[new Ext.Panel({autoScroll:true,html:t,height:180,width:450}),new Ext.Panel({autoScroll:true,html:n,height:180,width:450}),{xtype:"hidden",name:"a",value:"b"}],buttons:[actionButton("Correct","silk-accept","php/review/reviewContinuous.php?instruction=correct&card_id="+e,"Fetching Next Card","rpf2",reviewCallBack),actionButton("Again","silk-arrow-refresh","php/review/reviewContinuous.php?instruction=wrong&card_id="+e,"Recycling Card","rpf2",reviewCallBack)]});return r}function showAnswer(e,t,n){rpf2=reviewPanel2(e,t,n);formHandler2(rpf2,rpf2.getId())()}function inlineSuggest(){var e=new Ext.FormPanel({id:"is",labelWidth:255,frame:false,bodyStyle:"padding:5px 5px 0",height:65,border:false,items:[textField("Problem?  Suggestion?  Tell us - we're listening","suggestion",200)],buttons:[actionButton("Suggest","silk-accept","php/suggest/inlineSuggestion.php","Thanks, we'll get on it right away","is",isClean)]});return e}function isClean(){var e=Ext.getCmp("is");e.get(0).setValue("");e.show()}var mask=new Ext.LoadMask(Ext.getBody(),{msg:"Please wait...",removeMask:true});mask.show();var categoryMenu=new Ext.menu.Menu({items:[menuItem("rcm","Refresh Categories","silk-arrow-refresh",refreshCategories,false),"-",menuItem("ncm","Add Category","silk-folder-add",newCategory),menuItem("ecm","Edit Category","silk-folder-edit",editCategory),menuItem("dcm","Delete Category","silk-folder-delete",deleteCategory),"-",menuItem("bucm","Bulk Upload","silk-folder-go",bulkUpload)],listeners:{itemclick:function(e){switch(e.id){case"ncm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&(t.parentNode||t.text=="All")){var n=Ext.getCmp("ncf");var r=n.get(0);var i=n.get(1);i.getStore().load({callback:function(){i.setValue(t.id)}});r.setValue("New Category")}break;case"ecm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&t.parentNode){var s=Ext.getCmp("ecf");var i=s.get(0);var r=s.get(1);var o=s.get(2);i.getStore().load({callback:function(){i.setValue(t.id)}});o.getStore().load({callback:function(){o.setValue(t.parentNode.id)}});r.setValue(t.attributes["name"])}break;case"dcm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&t.parentNode){var i=Ext.getCmp("dcf").get(0);i.getStore().load({callback:function(){i.setValue(t.id)}})}break;case"bucm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&(t.parentNode||t.text=="All")){var n=Ext.getCmp("buf");var r=n.get(0);var i=n.get(1);i.getStore().load({callback:function(){i.setValue(t.id)}});r.setValue("Upload File")}break;case"crv":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();var u=Ext.getCmp("rf").get(0);u.getStore().load({callback:function(){u.setValue(t.id)}});break}}}});var categoryPane=new Ext.tree.TreePanel({id:"categoryPane",autoScroll:true,animate:true,enableDD:false,containerScroll:true,border:true,width:200,height:450,dataUrl:"php/category/categoryPane.php",root:{nodeType:"async",text:"All",draggable:false,id:"0"},rootVisible:false,contextMenu:categoryMenu,listeners:{contextmenu:function(e,t){e.select();var n=e.getOwnerTree().contextMenu;n.contextNode=e;n.showAt(t.getXY())}}});categoryPane.on("click",function(e,t){cardGrid.store.load({params:{category_id:e.id}})});categoryPane.render("leftColumn");var catMask=new Ext.LoadMask("categoryPane",{msg:"Loading categories...",removeMask:true});catMask.show();categoryPane.getRootNode().expand(false,true,function(){catMask.hide()});var cardMenu=new Ext.menu.Menu({items:[menuItem("rcrm","Refresh Cards","silk-arrow-refresh",refreshCards,false),"-",menuItem("ncrm","Add Card","silk-application-add",newCard),menuItem("ecrm","Edit Card","silk-application-edit",editCard),menuItem("dcrm","Delete Card","silk-application-delete",deleteCard),"-",menuItem("bucrm","Bulk Upload","silk-application-go",bulkUpload)],listeners:{itemclick:function(e){switch(e.id){case"ncrm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&(t.parentNode||t.text=="All")){var n=Ext.getCmp("ncrf");var r=n.get(0);var i=n.get(1);var s=n.get(2);s.getStore().load({callback:function(){s.setValue(t.id)}});r.setValue("New Question");i.setValue("New Answer")}break;case"ecrm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();var o=Ext.getCmp("cardGrid").getSelectionModel().getSelected();if(o!=null){var u=Ext.getCmp("ecrf");var a=u.get(0);var f=u.get(1);var l=u.get(2);var c=u.get(3);a.getStore().load({callback:function(){a.setValue(o.get("id"))}});c.getStore().load({callback:function(){c.setValue(t.id)}});f.setValue(o.get("question"));l.setValue(o.get("answer"))}break;case"dcrm":var o=Ext.getCmp("cardGrid").getSelectionModel().getSelected();if(o!=null){var s=Ext.getCmp("dcrf").get(0);s.getStore().load({callback:function(){s.setValue(o.get("id"))}})}break;case"bucrm":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();if(t!=null&&(t.parentNode||t.text=="All")){var h=Ext.getCmp("buf");var p=h.get(0);var s=h.get(1);s.getStore().load({callback:function(){s.setValue(t.id)}});p.setValue("Upload File")}break;break;case"crrv":var t=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();var c=Ext.getCmp("rf").get(0);c.getStore().load({callback:function(){c.setValue(t.id)}});break}}}});var cardGridStore=new Ext.data.ArrayStore({autoSave:true,url:"php/card/cardGrid.php",fields:[{name:"id",type:"int"},{name:"category_id",type:"int"},{name:"question",type:"string"},{name:"answer",type:"string"},{name:"hint",type:"string"},{name:"last_test",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"next_test",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"total_test",type:"int"},{name:"tests_passed",type:"int"},{name:"pass_rate",type:"float"}]});var cardGrid=new Ext.grid.GridPanel({id:"cardGrid",store:cardGridStore,columns:[{id:"Question",header:"Question",sortable:true,dataIndex:"question"},{id:"Pass Rate",header:"Pass Rate",sortable:true,renderer:percentage,dataIndex:"pass_rate",width:75,fixed:true,align:"right"},{id:"Last Test",header:"Last Test",sortable:true,renderer:Ext.util.Format.dateRenderer("Y m d"),dataIndex:"last_test",width:75,fixed:true,align:"center"},{id:"Next Test",header:"Next Test",sortable:true,renderer:date,dataIndex:"next_test",width:75,fixed:true,align:"center"}],stripeRows:true,autoExpandColumn:"Question",width:495,height:450,contextMenu:cardMenu,listeners:{headercontextmenu:function(e,t,n){n.stopEvent();e.contextMenu.showAt(n.getXY())},rowcontextmenu:function(e,t,n){n.stopEvent();e.getSelectionModel().selectRow(t);e.contextMenu.showAt(n.getXY())}}});cardGrid.render("rightColumn");var tb=new Ext.Toolbar({height:60,width:700});tb.add(toolbarButton("acc","My Account","silk-user-female-32",new Ext.menu.Menu({items:[menuItem("lom","Log out","silk-door-open",function(){window.location="php/login/logout.php"},false)]})),toolbarButton("cat","Category","silk-folder-32",categoryMenu),toolbarButton("card","Card","silk-application-32",cardMenu),new Ext.Toolbar.Button({id:"rbt",text:"Review!",iconAlign:"top",iconCls:"silk-page-go-32",handler:function(e,t){e.disable();var n=formHandler2(review(e),"rf")();if(n){var r=Ext.getCmp("categoryPane").getSelectionModel().getSelectedNode();var i=Ext.getCmp("rf").get(0);if(r!=null){i.getStore().load({callback:function(){i.setValue(r.id)}})}}},height:60,width:80,scale:"large"}));tb.render("topRow");var is=new inlineSuggest;is.render("inlineSuggestForm");mask.hide()